# Руководство по рефакторингу

## Компоненты, требующие рефакторинга

### 1. Sales.tsx (~1741 строка)

**Проблема:** Слишком большой монолитный компонент, объединяющий несколько функций.

**Рекомендуемое разделение:**

#### SalesCart.tsx
- Управление корзиной товаров
- Добавление/удаление товаров
- Поиск и фильтрация товаров

#### SalesCheckout.tsx
- Оформление заказа
- Выбор метода оплаты
- Расчет итоговой суммы

#### SalesExpense.tsx
- Управление расходами
- Форма добавления расхода

#### SalesReturn.tsx
- Обработка возвратов товаров
- Списание с долга клиента

#### SalesReceipt.tsx
- Печать и экспорт чеков
- Модальное окно чека

#### SalesHistory.tsx
- История заказов
- Фильтрация и поиск

#### ClientModal.tsx
- Модальное окно создания клиента
- Валидация данных клиента

**Пример структуры:**
```
components/sales/
  ├── Sales.tsx (главный компонент-оркестратор)
  ├── SalesCart.tsx
  ├── SalesCheckout.tsx
  ├── SalesExpense.tsx
  ├── SalesReturn.tsx
  ├── SalesReceipt.tsx
  ├── SalesHistory.tsx
  └── ClientModal.tsx
```

### 2. App.tsx (~754 строки)

**Проблема:** Содержит слишком много логики управления состоянием.

**Рекомендуемое разделение:**

#### hooks/useAppData.ts
- Управление загрузкой данных
- Сохранение данных
- Обработка ошибок

#### hooks/usePermissions.ts
- Проверка прав доступа
- Логика разрешений

#### components/layout/Sidebar.tsx
- Боковое меню
- Навигация

#### components/layout/Header.tsx
- Верхняя панель
- Кнопка сохранения

**Пример структуры:**
```
hooks/
  ├── useAppData.ts
  └── usePermissions.ts

components/layout/
  ├── Sidebar.tsx
  ├── Header.tsx
  └── SidebarItem.tsx
```

## План рефакторинга

### Этап 1: Подготовка
1. Создать структуру папок
2. Написать тесты для текущей функциональности
3. Создать ветку для рефакторинга

### Этап 2: Рефакторинг Sales.tsx
1. Вынести ClientModal в отдельный компонент
2. Вынести SalesCart
3. Вынести SalesCheckout
4. Вынести SalesExpense
5. Вынести SalesReturn
6. Вынести SalesReceipt
7. Вынести SalesHistory
8. Обновить главный Sales.tsx как оркестратор

### Этап 3: Рефакторинг App.tsx
1. Создать useAppData хук
2. Создать usePermissions хук
3. Вынести Sidebar компонент
4. Вынести Header компонент
5. Упростить App.tsx

### Этап 4: Тестирование
1. Проверить все функции
2. Исправить баги
3. Обновить документацию

## Преимущества рефакторинга

1. **Читаемость:** Меньшие компоненты легче понимать
2. **Переиспользование:** Компоненты можно использовать в других местах
3. **Тестирование:** Легче писать unit-тесты для маленьких компонентов
4. **Производительность:** Можно оптимизировать отдельные компоненты
5. **Поддержка:** Легче находить и исправлять баги

## Риски

1. **Время:** Рефакторинг требует времени
2. **Баги:** Возможны ошибки при разделении
3. **Тестирование:** Нужно тщательно протестировать все функции

## Рекомендации

- Делать рефакторинг постепенно, по одному компоненту
- Писать тесты перед рефакторингом
- Использовать feature flags для безопасного развертывания
- Регулярно коммитить изменения








